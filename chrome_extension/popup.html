<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>easyeda2kicad Companion</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="stylesheet" href="popup.css" />
</head>

<body>
  <div class="container py-3" id="app">
    <header class="app-header d-flex align-items-center justify-content-between pb-2 mb-2">
      <div class="header-title">
        <h1 class="h5 mb-0">LCSC Parts</h1>
        <div class="header-active" id="header-active"></div>
      </div>
      <span id="connection-status" class="badge rounded-pill text-bg-secondary" role="status" aria-live="polite">
        <span>Server status:</span>
        <span id="connection-status-dot"></span>
      </span>
    </header>

    <div class="tab-buttons" role="tablist" aria-label="Main navigation">
      <button class="tab-button active" type="button" id="tab-button-parts" data-tab="parts"
        aria-controls="tab-panel-parts" aria-selected="true">Get new part</button>
      <button class="tab-button" type="button" id="tab-button-libraries" data-tab="libraries"
        aria-controls="tab-panel-libraries" aria-selected="false">Library</button>
      <button class="tab-button" type="button" id="tab-button-settings" data-tab="settings"
        aria-controls="tab-panel-settings" aria-selected="false">Settings</button>
    </div>

    <main class="pt-2">
      <section id="tab-panel-parts" class="tab-panel active" role="tabpanel" aria-labelledby="tab-button-parts">
        <div class="card mb-3">
          <div class="card-body">
            <form id="parts-form" class="row g-3" novalidate>
              <div class="col-12">
                <label for="parts-lcsc" class="form-label">LCSC Part number<span class="text-accent"> *</span></label>
                <input id="parts-lcsc" type="text" class="form-control" placeholder="e.g. C8734" autocomplete="off"
                  required />
              </div>
              <div class="col-12">
                <div class="row gy-2 gx-3">
                  <div class="col-12 col-sm-4">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" role="switch" id="parts-symbol" checked />
                      <label class="form-check-label" for="parts-symbol">Symbol</label>
                    </div>
                  </div>
                  <div class="col-12 col-sm-4">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="parts-footprint" checked />
                      <label class="form-check-label" for="parts-footprint">Footprint</label>
                    </div>
                  </div>
                  <div class="col-12 col-sm-4">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="parts-model" checked />
                      <label class="form-check-label" for="parts-model">3D Model</label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12">
              </div>
              <div class="col-12">
                <button class="btn btn-primary w-100" type="submit" id="parts-submit">Download</button>
              </div>
            </form>
          </div>
        </div>

      </section>

      <section id="tab-panel-libraries" class="tab-panel" role="tabpanel" aria-labelledby="tab-button-libraries">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-column gap-2">
              <div class="d-flex align-items-center justify-content-between gap-2 flex-wrap">
                <div class="position-relative">
                  <span class="fw-semibold" style="position: relative; top: 1px;">Libraries</span>
                  <button class="btn btn-sm btn-primary" type="button" id="library-add"
                    aria-haspopup="dialog">Add</button>
                </div>
                <div class="d-flex align-items-center gap-2 library-tools">
                  <input id="library-search" type="text" class="form-control" placeholder="Search…"
                    aria-label="Search libraries" />
                </div>
              </div>
              <div class="library-summary small text-muted" id="library-summary"></div>
            </div>
            <div id="library-list" class="list-group"></div>
          </div>
        </div>
      </section>

      <section id="tab-panel-settings" class="tab-panel" role="tabpanel" aria-labelledby="tab-button-settings">
        <div class="card">
          <div class="card-body">
            <form id="settings-form" class="row g-3" novalidate>
              <div class="col-12">
                <label for="settings-server" class="form-label">Server URL</label>
                <div class="input-group">
                  <input id="settings-server" type="text" class="form-control" placeholder="http://localhost:8087" />
                  <button class="btn btn-primary" type="button" id="settings-test">Test</button>
                </div>
              </div>
              <div class="col-12">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="settings-overwrite" />
                  <label class="form-check-label" for="settings-overwrite">Overwrite footprints &amp; symbols by
                    default</label>
                </div>
              </div>
              <div class="col-12">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="settings-overwrite-model" />
                  <label class="form-check-label" for="settings-overwrite-model">Overwrite 3D models by default</label>
                </div>
              </div>
              <div class="col-12">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="settings-debug" />
                  <label class="form-check-label" for="settings-debug">Enable debug logging</label>
                </div>
              </div>
              <div class="col-12">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="settings-project-relative" />
                  <label class="form-check-label" for="settings-project-relative">Project relative 3D paths by
                    default</label>
                </div>
                <div class="mt-2" id="settings-project-relative-path-group" hidden>
                  <label class="form-label" for="settings-project-relative-path">Default project relative 3D base
                    path</label>
                  <div class="input-group">
                    <span class="input-group-text">${KIPRJMOD}</span>
                    <input class="form-control" id="settings-project-relative-path" type="text"
                      placeholder="../../library" />
                  </div>
                </div>
              </div>
            </form>
          </div>
          <div class="card-footer small" id="settings-feedback" aria-live="polite"></div>
        </div>
      </section>
    </main>
  </div>

  <div class="toast-container position-fixed top-0 end-0 p-3" id="toast-container" aria-live="polite"></div>

  <div class="modal fade" id="library-required-modal" tabindex="-1" aria-labelledby="library-required-title"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title h5" id="library-required-title">Library required</h2>
        </div>
        <div class="modal-body">
          Please activate or create a library before starting a download.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" data-focus-tab="libraries">Select
            library</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="library-modal" tabindex="-1" aria-labelledby="library-modal-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title h5" id="library-modal-title">Add library</h2>
        </div>
        <div class="modal-body">
          <div class="tab-content">
            <div class="tab-pane fade show active" id="library-modal-create" role="tabpanel">
              <form id="library-create-form" class="row g-3" novalidate>
                <div class="col-12">
                  <label for="library-create-name" class="form-label">Library name<span class="text-accent">
                      *</span></label>
                  <input id="library-create-name" type="text" class="form-control" placeholder="MyLibrary" required />
                </div>
                <div class="col-12">
                  <label for="library-create-path" class="form-label">Base folder<span class="text-accent">
                      *</span></label>
                  <div class="input-group">
                    <input id="library-create-path" type="text" class="form-control" placeholder="Select folder"
                      readonly required />
                    <button class="btn btn-primary" type="button" data-picker="create">Browse…</button>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="library-create-symbol" checked />
                    <label class="form-check-label" for="library-create-symbol">Create symbol library
                      (.kicad_sym)</label>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="library-create-footprint" checked />
                    <label class="form-check-label" for="library-create-footprint">Create footprint folder
                      (.pretty)</label>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="library-create-model" checked />
                    <label class="form-check-label" for="library-create-model">Create 3D folder (.3dshapes)</label>
                  </div>
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="library-create-project" checked />
                    <label class="form-check-label" for="library-create-project">Project relative 3D paths</label>
                  </div>
                  <div class="mt-2" id="library-create-project-path-group" hidden>
                    <label class="form-label" for="library-create-project-path">Project relative 3D base path</label>
                    <div class="input-group">
                      <span class="input-group-text">${KIPRJMOD}</span>
                      <input id="library-create-project-path" type="text" class="form-control"
                        placeholder="../../library" />
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="me-auto text-danger small" id="library-modal-error"></div>
        </div>
        <div class="modal-footer">
          <div class="flex-grow-1">
            <button type="button" class="btn btn-primary" data-picker="import">Import library</button>
          </div>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="library-modal-submit">Create</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="picker-modal" tabindex="-1" aria-labelledby="picker-modal-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title h5" id="picker-modal-title">Select folder</h2>
        </div>
        <div class="modal-body">
          <label for="picker-manual" class="form-label">Path</label>
          <input type="text" id="picker-manual" class="form-control mb-2" placeholder="Enter path manually" />
          <div id="picker-path-breadcrumb" class="d-flex flex-wrap gap-2 mb-3"></div>
          <ul class="list-group" id="picker-list" tabindex="0"></ul>
          <div class="text-danger small mt-1 mb-1" id="picker-error" role="alert"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="picker-apply">Select</button>
        </div>
      </div>
    </div>
  </div>

  <script src="popup.js" type="module"></script>
</body>

</html>